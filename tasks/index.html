tasks



<div>
  Connect:
  <a href="https://accounts.google.com/o/oauth2/v2/auth?scope=https%3A//www.googleapis.com/auth/gmail.modify&include_granted_scopes=true&response_type=token&state=state_parameter_passthrough_value&redirect_uri=https%3A//odedhb.github.io/tasks&client_id=1073341794222-i9c7tmc8dikhmdd67b5m2bp0svp8vghq.apps.googleusercontent.com
">Google</a>
</div>

<script>
  const params = new URLSearchParams(location.hash);
  const paramObj = Object.fromEntries(params.entries());
  console.log({ paramObj });
  const state = paramObj['#state'];
  if (state) {
    localStorage.setItem(state, JSON.stringify(paramObj));
  }
  const gmailApiUrl = 'https://www.googleapis.com/gmail/v1/users/me/messages';
  const accessToken = JSON.parse(localStorage.getItem('state_parameter_passthrough_value')).access_token;
  fetch(gmailApiUrl, {
    headers: {
      Authorization: `Bearer ${accessToken}`
    }
  })
    .then(res => res.json())
    .then(console.log)
    .catch(console.error);
</script>