<!DOCTYPE html>
<html>

<body>
    <h1>Put.io</h1>
    <p>Previewer</p>

    <div id="auth">
        <a
            href="https://app.put.io/authenticate?client_id=5165&redirect_uri=https%3A%2F%2Fodedhb.github.io%2Fputio&response_type=token">Connect
            via Put.io</a>
    </div>

    <div id="main_view"></div>
</body>

</html>

<script>
    if (window.location.hash) {
        document.getElementById("auth").style.display = "none";
        let token = getHashValue("token");
        console.log(token);

        showVideos(token);
    }

    function getHashValue(key) {
        var matches = location.hash.match(new RegExp(key + '=([^&]*)'));
        return matches ? matches[1] : null;
    }

    async function showVideos(token, parentID) {

        if (!parentID) {
            parentID = 0;
        }

        let result = await fetch('https://api.put.io/v2/files/list', {
            method: 'GET',
            headers: {
                Authorization: "Bearer " + token,
                'Content-Type': 'application/json'
            }
            // body: JSON.stringify(data),
        });
        console.log(result);
        let contents = result.json();
        console.log(contents);
        for (let file of contents.files) {
            await showVideo(token, file);
        }
    }

    async function showVideo(token, file) {
        if (file.file_type === "FOLDER") {
            showVideos(token, file.id);
        }
        console.log("file", file);
    }
</script>